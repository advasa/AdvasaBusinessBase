# AdvasaBusinessBase CDK

AdvasaBusinessBaseã¯ã€Advasaã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…ã†ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã‚’AWSä¸Šã§ã‚³ã‚¹ãƒˆåŠ¹ç‡è‰¯ãé‹ç”¨ã™ã‚‹ãŸã‚ã®AWS CDKãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

![AWS](https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazon-aws&logoColor=white)
![CDK](https://img.shields.io/badge/AWS_CDK-FF9900?style=for-the-badge&logo=amazon-aws&logoColor=white)
![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)
![Python](https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white)

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹](#ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹)
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [è¨­å®š](#è¨­å®š)
- [ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒ‡ãƒ—ãƒ­ã‚¤)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

## ğŸ¯ æ¦‚è¦

AdvasaBusinessBaseã¯ã€æ—¢å­˜ã®AdvasaåŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ã¨ã¯ç‹¬ç«‹ã—ãŸCDKãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š

### âœ¨ ä¸»è¦ç‰¹å¾´

- **ğŸ”§ æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç°¡å˜ã«è¿½åŠ å¯èƒ½
- **ğŸŒ ãƒãƒ«ãƒç’°å¢ƒ**: dev/stg/prodã®ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒãƒ¼ãƒˆ
- **ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: VPCãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆé…ç½®ã€æœ€å°æ¨©é™IAMã€VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: é©åˆ‡ãªãƒªã‚½ãƒ¼ã‚¹è¨­å®šã¨ã‚¿ã‚°ç®¡ç†
- **ğŸ“Š ç›£è¦–**: CloudWatchçµ±åˆã¨Slacké€šçŸ¥ã€X-Rayåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- **ğŸ§ª ãƒ†ã‚¹ãƒˆ**: åŒ…æ‹¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **ğŸš€ APIçµ±åˆ**: API GatewayçµŒç”±ã®Slack Events/Interactive API

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AdvasaBusinessBase                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ Microservices Layer                                     â”‚
â”‚  â”œâ”€â”€ ğŸ¦ ZenginDataUpdater (éŠ€è¡Œãƒ‡ãƒ¼ã‚¿åŒæœŸ)                    â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ” Diff Processor Lambda                          â”‚
â”‚  â”‚   â”œâ”€â”€ âš¡ Callback Handler Lambda                        â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸš€ Diff Executor Lambda                           â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ“¢ Slack Events Lambda                            â”‚
â”‚  â”‚   â””â”€â”€ ğŸ”„ Slack Interactive Lambda                       â”‚
â”‚  â””â”€â”€ ğŸ“ˆ [Future Services]                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ Common Infrastructure                                   â”‚
â”‚  â”œâ”€â”€ ğŸŒ VPC Integration (æ—¢å­˜VPCã«æ¥ç¶š)                      â”‚
â”‚  â”œâ”€â”€ ğŸ”— VPC Endpoints (PrivateLink)                        â”‚
â”‚  â”œâ”€â”€ ğŸ—„ï¸ DynamoDB Tables                                     â”‚
â”‚  â”œâ”€â”€ â° EventBridge Schedulers                              â”‚
â”‚  â”œâ”€â”€ ğŸ” Secrets Manager                                     â”‚
â”‚  â”œâ”€â”€ ğŸŒ API Gateway                                         â”‚
â”‚  â”œâ”€â”€ ğŸ“Š CloudWatch Monitoring                               â”‚
â”‚  â””â”€â”€ ğŸ“ Enhanced Logging                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ—¢å­˜ Advasa VPC                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Private Subnet    â”‚  â”‚      Private Subnet             â”‚  â”‚
â”‚  â”‚                     â”‚  â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€Lambda Functions â”‚  â”‚  â”Œâ”€â”€RDS (advasa-django)        â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Diff Processorâ”‚  â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Callback      â”‚  â”‚  â”‚  â”Œâ”€â”€Security Groups        â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Executor      â”‚  â”‚  â”‚  â”‚  â””â”€ Database Access     â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Slack Events  â”‚  â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Interactive   â”‚  â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  â””â”€â”€DynamoDB Tables  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                 VPC Endpoints                               â”‚â”‚
â”‚  â”‚  â”œâ”€ Secrets Manager â”œâ”€ CloudWatch Logs â”œâ”€ EventBridge     â”‚â”‚
â”‚  â”‚  â”œâ”€ CloudWatch      â”œâ”€ EventBridge Scheduler â”œâ”€ Lambda    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹

### ğŸ¦ Zengin Data Updater

éŠ€è¡Œæƒ…å ±ã®è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ ã€‚å…¨éŠ€ãƒ‡ãƒ¼ã‚¿ã¨ã®å·®åˆ†ã‚’æ¤œå‡ºã—ã€Slackæ‰¿èªãƒ•ãƒ­ãƒ¼ã‚’çµŒã¦æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

#### ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼
```
[æ¯æ—¥ EventBridge] 
        â†“
   ğŸ” Lambdaâ‘  (å·®åˆ†å–å¾—ãƒ»æ¯”è¼ƒ)
        â†“
 ğŸ’¾ DynamoDB (å·®åˆ†ãƒ¬ã‚³ãƒ¼ãƒ‰ä¿å­˜) â†â”
        â†“                     â”‚
 ğŸŒ API Gateway â†â”€â”€â”€ ğŸ’¬ Slacké€šçŸ¥               â”‚
        â†“                     â”‚
[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãŒSlackã§æ‰¿èªï¼å´ä¸‹ï¼‹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é¸æŠ] 
        â†“
âš¡ Lambdaâ‘¡ (ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å—ä¿¡ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²)  
        â†“
â”Œâ”€â”€â”€â° EventBridge Scheduler (ä¸€åº¦ãã‚Šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«)â”€â”€â”€â”
â”‚                                                    â”‚
â”‚     [23:00ï¼å³æ™‚ï¼1hå¾Œï¼3hå¾Œï¼5hå¾Œ ãªã©]            â”‚
â”‚                                                    â†“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ğŸš€ Lambdaâ‘¢ (å·®åˆ†æ›´æ–°å®Ÿè¡Œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ğŸ—„ï¸ RDS (advasa-django DB)
                                                      â†“
                                                ğŸ“± Slackã¸çµæœé€šçŸ¥
```

#### ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£:**
- **Lambda Functions**: Python 3.11ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  (psycopg2ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»˜ã)
- **DynamoDB**: å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆTTLã€GSIä»˜ãï¼‰
- **EventBridge**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ï¼ˆæ—¥æ¬¡ + å‹•çš„ï¼‰
- **Secrets Manager**: èªè¨¼æƒ…å ±ç®¡ç†
- **API Gateway**: Slack Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **S3**: å¤§å®¹é‡å·®åˆ†ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- **CloudWatch**: ç›£è¦–ãƒ»ãƒ­ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒ 

**ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**

1. **ğŸ” Diff Processor Lambda** (`src/lambda/zengin-diff-processor/`)
   - å¤–éƒ¨å…¨éŠ€ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
   - æ—¢å­˜DBãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒ
   - å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆDynamoDB + S3ï¼‰
   - Slacké€šçŸ¥ã®é€ä¿¡

2. **âš¡ Callback Handler Lambda** (`src/lambda/zengin-callback-handler/`)
   - Slackã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ“ä½œã®å‡¦ç†
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èª/å´ä¸‹ã®å‡¦ç†
   - EventBridge Schedulerã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°

3. **ğŸš€ Executor Lambda** (`src/lambda/zengin-diff-executor/`)
   - æ‰¿èªã•ã‚ŒãŸå·®åˆ†ã®å®Ÿè¡Œ
   - PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
   - å®Œäº†é€šçŸ¥ã®é€ä¿¡

4. **ğŸ“¢ Slack Events Lambda** (`src/lambda/slack-events/`)
   - Slack Events API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†

5. **ğŸ”„ Slack Interactive Lambda** (`src/lambda/slack-interactive/`)
   - Slack ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‡¦ç†
   - ãƒœã‚¿ãƒ³ãƒ»ã‚»ãƒ¬ã‚¯ãƒˆç­‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå‡¦ç†

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- **Node.js 22+** & npm
- **AWS CLI** (é©åˆ‡ãªèªè¨¼æƒ…å ±è¨­å®šæ¸ˆã¿)
- **AWS CDK CLI v2.200.0+**
- **Docker** (psycopg2ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆç”¨)

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/advasa/AdvasaBusinessBase.git
cd AdvasaBusinessBase
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. AWS CDK ã®åˆæœŸè¨­å®š

```bash
# CDK Bootstrap (åˆå›ã®ã¿)
npx cdk bootstrap aws://YOUR_ACCOUNT_ID/ap-northeast-1

# TypeScript ã®ãƒ“ãƒ«ãƒ‰
npm run build
```

### 4. psycopg2ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ

```bash
cd layers/psycopg2
./build.sh
```

## âš™ï¸ è¨­å®š

### ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

å„ç’°å¢ƒã®è¨­å®šã‚’ `config/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç®¡ç†ï¼š

```
config/
â”œâ”€â”€ dev.json     # é–‹ç™ºç’°å¢ƒè¨­å®š
â”œâ”€â”€ stg.json     # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒè¨­å®š
â””â”€â”€ prod.json    # æœ¬ç•ªç’°å¢ƒè¨­å®š
```

### ä¸»è¦è¨­å®šé …ç›®

**åŸºæœ¬è¨­å®š**:
- AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãƒ»ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãƒ»ç’°å¢ƒå
- ã‚¿ã‚°è¨­å®š

**VPCè¨­å®š**:
- æ—¢å­˜VPC ID
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆID

**ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š**:
- Lambdaè¨­å®šï¼ˆãƒ¡ãƒ¢ãƒªãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ç’°å¢ƒå¤‰æ•°ï¼‰
- DynamoDBè¨­å®šï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«åãƒ»èª²é‡‘ãƒ¢ãƒ¼ãƒ‰ãƒ»TTLï¼‰
- EventBridgeè¨­å®šï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å¼ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—åï¼‰
- Slackè¨­å®šï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆARNãƒ»ãƒãƒ£ãƒ³ãƒãƒ«IDï¼‰

è©³ç´°ã¯ [docs/setup.md](docs/setup.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### ã‚¯ã‚¤ãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# é–‹ç™ºç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:dev

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤  
npm run deploy:stg

# æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:prod
```

### æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. è¨­å®šç¢ºèª
npm run synth:dev

# 2. å·®åˆ†ç¢ºèª
npm run diff:dev

# 3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
npx cdk deploy --context env=dev "*"
```

**æ³¨æ„**: CLAUDE.mdã®æŒ‡ç¤ºã«å¾“ã„ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ã¯è‡ªå‹•å®Ÿè¡Œã›ãšã€å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ã‚’æç¤ºã—ã¾ã™ã€‚

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### æ—¥å¸¸é‹ç”¨

#### 1. ãƒ­ã‚°ã®ç¢ºèª
```bash
# Lambdaé–¢æ•°ã®ãƒ­ã‚°ç¢ºèª
aws logs tail /aws/lambda/dev-zengin-diff-processor --follow

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª
aws logs filter-log-events \
  --log-group-name /aws/lambda/dev-zengin-diff-processor \
  --filter-pattern "ERROR"
```

#### 2. DynamoDB ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
```bash
# å·®åˆ†ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª
aws dynamodb scan --table-name zengin-data-diff-dev
```

#### 3. æ‰‹å‹•å®Ÿè¡Œ
```bash
# å·®åˆ†å‡¦ç†ã®æ‰‹å‹•å®Ÿè¡Œ
aws lambda invoke \
  --function-name dev-zengin-diff-processor \
  --payload '{"trigger": "manual"}' \
  response.json
```

### Slackçµ±åˆ

**è¨­å®šè¦ç´ **:
- Events API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `{API_GATEWAY_URL}/events`
- Interactive Components ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `{API_GATEWAY_URL}/interactive`
- Bot Token Scopes: `chat:write`, `channels:read`
- ç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®è¨­å®š

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
npm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
npm run test:coverage

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
npm test -- config.test.ts
```

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ `docs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Šã¾ã™ï¼š

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | å†…å®¹ |
|-------------|------|
| [docs/architecture.md](docs/architecture.md) | ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´° |
| [docs/setup.md](docs/setup.md) | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| [docs/deployment.md](docs/deployment.md) | ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰ |
| [docs/api-reference.md](docs/api-reference.md) | APIä»•æ§˜ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| [docs/database-schema.md](docs/database-schema.md) | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ |

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. VPCè¨­å®šã‚¨ãƒ©ãƒ¼
```
Error: VPC vpc-xxxxx not found
```
**è§£æ±ºæ–¹æ³•**: `config/*.json` ã® `vpcId` ãŒæ­£ã—ã„ã‹ç¢ºèª

#### 2. psycopg2 ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼
```
Error: No module named 'psycopg2'
```
**è§£æ±ºæ–¹æ³•**: `layers/psycopg2/build.sh` ã‚’å®Ÿè¡Œã—ã¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å†ä½œæˆ

#### 3. Slackç½²åæ¤œè¨¼ã‚¨ãƒ©ãƒ¼
```
Error: Invalid Slack signature
```
**è§£æ±ºæ–¹æ³•**: Secrets Managerã®ç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### 4. Lambda VPCæ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
```
Error: Task timed out after X seconds
```
**è§£æ±ºæ–¹æ³•**: VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºå¢—åŠ 

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

#### 1. CloudWatch Logs ã®ç¢ºèª
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–
aws logs tail /aws/lambda/FUNCTION_NAME --follow

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ¤œç´¢
aws logs filter-log-events \
  --log-group-name /aws/lambda/FUNCTION_NAME \
  --filter-pattern "ERROR"
```

#### 2. X-Ray åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- Lambdaé–¢æ•°ã®è©³ç´°ãªå®Ÿè¡Œãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèª
- å¤–éƒ¨APIå‘¼ã³å‡ºã—ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®æ€§èƒ½åˆ†æ

#### 3. CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- Lambdaå®Ÿè¡Œæ™‚é–“ãƒ»ã‚¨ãƒ©ãƒ¼ç‡
- DynamoDBèª­ã¿æ›¸ãã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
- API Gateway ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
AdvasaBusinessBase/
â”œâ”€â”€ bin/                              # CDKã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ advasa-business-base.ts
â”œâ”€â”€ lib/                              # CDKã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ common/                       # å…±é€šã‚¤ãƒ³ãƒ•ãƒ©
â”‚   â”‚   â”œâ”€â”€ config.ts                # è¨­å®šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ infrastructure/          # ã‚¤ãƒ³ãƒ•ãƒ©ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ dynamodb-construct.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ eventbridge-construct.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ secrets-construct.ts
â”‚   â”‚   â”‚   â””â”€â”€ api-gateway-construct.ts
â”‚   â”‚   â”œâ”€â”€ monitoring/              # ç›£è¦–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ cloudwatch-construct.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ x-ray-construct.ts
â”‚   â”‚   â”‚   â””â”€â”€ monitoring-stack.ts
â”‚   â”‚   â””â”€â”€ networking/              # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
â”‚   â”‚       â””â”€â”€ vpc-construct.ts
â”‚   â””â”€â”€ microservices/              # ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹
â”‚       â””â”€â”€ zengin-data-updater/
â”‚           â”œâ”€â”€ lambda-construct.ts
â”‚           â””â”€â”€ zengin-data-updater-stack.ts
â”œâ”€â”€ src/                             # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â””â”€â”€ lambda/                      # Lambdaé–¢æ•°
â”‚       â”œâ”€â”€ common/                  # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ zengin-diff-processor/
â”‚       â”œâ”€â”€ zengin-callback-handler/
â”‚       â”œâ”€â”€ zengin-diff-executor/
â”‚       â”œâ”€â”€ slack-events/
â”‚       â””â”€â”€ slack-interactive/
â”œâ”€â”€ config/                          # ç’°å¢ƒè¨­å®š
â”‚   â”œâ”€â”€ dev.json
â”‚   â”œâ”€â”€ stg.json
â”‚   â””â”€â”€ prod.json
â”œâ”€â”€ layers/                          # Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚   â””â”€â”€ psycopg2/
â”œâ”€â”€ test/                            # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ docs/                            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ scripts/                         # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## ğŸ”§ æ–°ã—ã„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®è¿½åŠ 

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
```json
// config/dev.json ã«è¿½åŠ 
{
  "microservices": {
    "zenginDataUpdater": { ... },
    "newService": {
      "enabled": true,
      "lambda": { ... }
    }
  }
}
```

### 2. CDKã‚¹ã‚¿ãƒƒã‚¯ã®ä½œæˆ
```typescript
// lib/microservices/new-service/new-service-stack.ts
export class NewServiceStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props: NewServiceStackProps) {
    super(scope, id, props);
    // ã‚¹ã‚¿ãƒƒã‚¯å®Ÿè£…
  }
}
```

### 3. ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®æ›´æ–°
```typescript
// bin/advasa-business-base.ts ã«è¿½åŠ 
if (config.microservices.newService?.enabled) {
  const newServiceStack = new NewServiceStack(app, `${config.env}-NewService`, {
    config,
    vpcConstruct,
    env: deployEnv,
  });
  stacks.push(newServiceStack);
}
```

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ‘¥ ãƒãƒ¼ãƒ 

- **é–‹ç™ºãƒãƒ¼ãƒ **: advasa-dev@example.com
- **ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ **: advasa-infra@example.com
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: pm@advasa.com

---

**Powered by AWS CDK & Advasa Engineering Team** ğŸš€