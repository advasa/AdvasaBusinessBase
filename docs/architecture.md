# AdvasaBusinessBase - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ“‹ ç›®æ¬¡

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
- [ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ](#ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ)
- [ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°](#ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [ç›£è¦–ãƒ»å¯è¦³æ¸¬æ€§](#ç›£è¦–å¯è¦³æ¸¬æ€§)
- [ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£](#ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£)
- [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

AdvasaBusinessBaseã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã€AWSä¸Šã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¹è¨­è¨ˆã«ã‚ˆã‚Šé«˜å¯ç”¨æ€§ã¨ã‚³ã‚¹ãƒˆåŠ¹ç‡ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AdvasaBusinessBase                                â”‚
â”‚                   Event-Driven Microservices                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   API Gateway Layer                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚   Slack     â”‚  â”‚   Health    â”‚  â”‚   Future    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   Events    â”‚  â”‚   Check     â”‚  â”‚   APIs      â”‚           â”‚   â”‚
â”‚  â”‚  â”‚     API     â”‚  â”‚     API     â”‚  â”‚             â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Lambda Functions Layer                        â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚   Slack      â”‚  â”‚   Slack      â”‚  â”‚   Zengin     â”‚        â”‚   â”‚
â”‚  â”‚  â”‚   Events     â”‚  â”‚ Interactive  â”‚  â”‚    Diff      â”‚        â”‚   â”‚
â”‚  â”‚  â”‚   Handler    â”‚  â”‚   Handler    â”‚  â”‚  Processor   â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚           â”‚                  â”‚               â”‚                â”‚   â”‚
â”‚  â”‚           â–¼                  â–¼               â–¼                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚   Callback   â”‚  â”‚   Diff       â”‚  â”‚   Future     â”‚        â”‚   â”‚
â”‚  â”‚  â”‚   Handler    â”‚  â”‚  Executor    â”‚  â”‚  Functions   â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Data & Storage Layer                         â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  DynamoDB   â”‚  â”‚     S3      â”‚  â”‚ PostgreSQL  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ Diff Tables â”‚  â”‚Diff Storage â”‚  â”‚(advasa-db)  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   (NoSQL)   â”‚  â”‚  (Object)   â”‚  â”‚ (Relational)â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Integration & Orchestration                      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ EventBridge â”‚  â”‚   Secrets   â”‚  â”‚ CloudWatch  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ Schedulers  â”‚  â”‚  Manager    â”‚  â”‚  Monitoring â”‚           â”‚   â”‚
â”‚  â”‚  â”‚(Orchestrate)â”‚  â”‚ (Security)  â”‚  â”‚(Observab.)  â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

### 1. API Gateway Layer (ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ)

**ç›®çš„**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSlackï¼‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã€é©åˆ‡ãªLambdaé–¢æ•°ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- **Slack Events API**: Slack Events APIã‹ã‚‰ã®Webhookå—ä¿¡
- **Slack Interactive API**: Slackã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
- **Health Check API**: ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

**æŠ€è¡“ä»•æ§˜**:
```typescript
// API Gateway è¨­å®š
apiGateway = new ApiGatewayConstruct(this, 'SlackApi', {
  apiName: `${config.env}-zengin-slack-api`,
  stage: 'v1',
  throttleRateLimit: 100,      // 100 req/sec
  throttleBurstLimit: 200,     // ãƒãƒ¼ã‚¹ãƒˆ 200 req
  enableCors: true,
  enableLogging: true,
});
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**:
- Slackç½²åæ¤œè¨¼ã«ã‚ˆã‚‹èªè¨¼
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«ã‚ˆã‚‹DDoSé˜²æ­¢
- CORSè¨­å®šã«ã‚ˆã‚‹é©åˆ‡ãªã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡

### 2. Compute Layer (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)

**ç›®çš„**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ

#### Lambdaé–¢æ•°æ§‹æˆ

| é–¢æ•°å | å½¹å‰² | ãƒˆãƒªã‚¬ãƒ¼ | å®Ÿè¡Œç’°å¢ƒ |
|--------|------|----------|----------|
| `slack-events` | Slack Events APIå‡¦ç† | API Gateway | VPCå†…ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |
| `slack-interactive` | Slackã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å‡¦ç† | API Gateway | VPCå†…ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |
| `zengin-diff-processor` | å…¨éŠ€ãƒ‡ãƒ¼ã‚¿å·®åˆ†æ¤œå‡º | EventBridge (daily) | VPCå†…ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |
| `zengin-callback-handler` | æ‰¿èªãƒ•ãƒ­ãƒ¼å‡¦ç† | Manual Invoke | VPCå†…ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |
| `zengin-diff-executor` | å·®åˆ†å®Ÿè¡Œå‡¦ç† | EventBridge (dynamic) | VPCå†…ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ |

#### VPCé…ç½®è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Advasa VPC                           â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Private Subnet A    â”‚  â”‚   Private Subnet B    â”‚   â”‚
â”‚  â”‚                       â”‚  â”‚                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Lambda Functionsâ”‚  â”‚  â”‚  â”‚     RDS         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚ (advasa-django) â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚Events       â”‚ â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚Interactive  â”‚ â”‚  â”‚  â”‚                       â”‚   â”‚
â”‚  â”‚  â”‚ â”‚DiffProcessorâ”‚ â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚Callback     â”‚ â”‚  â”‚  â”‚  â”‚Security Groups  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚Executor     â”‚ â”‚  â”‚  â”‚  â”‚DB Access        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                VPC Endpoints                        â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ â”‚Secrets   â”‚ â”‚CloudWatchâ”‚ â”‚EventBridgeâ”‚ â”‚Lambda   â”‚â”‚ â”‚
â”‚  â”‚ â”‚Manager   â”‚ â”‚Logs      â”‚ â”‚Scheduler  â”‚ â”‚Service  â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Data & Storage Layer (ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–)

**ç›®çš„**: ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã€æ¤œç´¢ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

#### DynamoDBè¨­è¨ˆ

**ãƒ†ãƒ¼ãƒ–ãƒ«**: `zengin-data-diff-{env}`

```json
{
  "TableName": "zengin-data-diff-dev",
  "KeySchema": [
    {
      "AttributeName": "id",
      "KeyType": "HASH"          // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼
    },
    {
      "AttributeName": "timestamp", 
      "KeyType": "RANGE"         // ã‚½ãƒ¼ãƒˆã‚­ãƒ¼
    }
  ],
  "GlobalSecondaryIndexes": [
    {
      "IndexName": "StatusIndex",
      "KeySchema": [
        {
          "AttributeName": "status",
          "KeyType": "HASH"
        },
        {
          "AttributeName": "timestamp",
          "KeyType": "RANGE"
        }
      ]
    }
  ],
  "BillingMode": "PAY_PER_REQUEST",
  "PointInTimeRecoverySpecification": {
    "PointInTimeRecoveryEnabled": true   // æœ¬ç•ªç’°å¢ƒã®ã¿
  },
  "TimeToLiveSpecification": {
    "AttributeName": "ttl",
    "Enabled": true
  }
}
```

**ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³**:
1. **å·®åˆ†ä½œæˆ**: `PutItem` by `id`
2. **çŠ¶æ…‹æ›´æ–°**: `UpdateItem` by `id` + `timestamp`
3. **çŠ¶æ…‹åˆ¥å–å¾—**: `Query` on `StatusIndex`
4. **æœŸé™åˆ‡ã‚Œå‰Šé™¤**: TTL by `ttl` attribute

#### S3è¨­è¨ˆ

**ãƒã‚±ãƒƒãƒˆ**: `{env}-zengin-diff-data`

```typescript
const bucket = new s3.Bucket(this, 'DiffDataBucket', {
  versioned: true,
  encryption: s3.BucketEncryption.S3_MANAGED,
  lifecycleRules: [
    {
      id: 'DeleteOldDiffs',
      enabled: true,
      expiration: cdk.Duration.days(90),      // 90æ—¥ã§å‰Šé™¤
      noncurrentVersionExpiration: cdk.Duration.days(30),
    },
  ],
});
```

**ç”¨é€”**:
- å¤§å®¹é‡å·®åˆ†ãƒ‡ãƒ¼ã‚¿ (>400KB) ã®ä¿å­˜
- ãƒã‚¤ãƒŠãƒªå½¢å¼ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
- å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

### 4. Integration & Orchestration Layer (çµ±åˆãƒ»èª¿æ•´)

**ç›®çš„**: ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ç›£è¦–

#### EventBridge Scheduler

**æ—¥æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**:
```json
{
  "ScheduleExpression": "cron(0 23 * * ? *)",  // æœ¬ç•ª: 23:00
  "ScheduleExpressionTimezone": "Asia/Tokyo",
  "Target": {
    "Arn": "arn:aws:lambda:region:account:function:zengin-diff-processor",
    "Input": "{\"trigger\": \"daily\"}"
  }
}
```

**å‹•çš„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«** (ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ å®Ÿè¡Œ):
```json
{
  "ScheduleExpression": "at(2024-01-01T23:00:00)",
  "Target": {
    "Arn": "arn:aws:lambda:region:account:function:zengin-diff-executor",
    "Input": "{\"diffId\": \"diff-20240101-001\"}"
  }
}
```

## ğŸ”§ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°

### Zengin Data Updater ã‚µãƒ¼ãƒ“ã‚¹

#### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Zengin Data Updater Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â‘ Daily Trigger â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EventBridge â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        Diff Processor              â”‚ â”‚
â”‚  â”‚ Scheduler   â”‚                 â”‚                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”Œâ”€ Fetch Zengin Data              â”‚ â”‚
â”‚                                  â”‚ â”œâ”€ Fetch Current DB Data          â”‚ â”‚
â”‚                                  â”‚ â”œâ”€ Compare & Generate Diff        â”‚ â”‚
â”‚                                  â”‚ â”œâ”€ Store to DynamoDB             â”‚ â”‚
â”‚                                  â”‚ â””â”€ Large Data â†’ S3               â”‚ â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚                      â”‚
â”‚                                                  â–¼ â‘¡Slack Notification   â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                â”‚                     Slack                              â”‚ â”‚
â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                â”‚ â”‚  ğŸ“Š å·®åˆ†æ¤œå‡ºé€šçŸ¥                                     â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â”Œâ”€ è¿½åŠ : 3ä»¶                                      â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â”œâ”€ æ›´æ–°: 2ä»¶                                      â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â””â”€ å‰Šé™¤: 1ä»¶                                      â”‚ â”‚ â”‚
â”‚                â”‚ â”‚                                                   â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  [æ‰¿èª] [å´ä¸‹] [å®Ÿè¡Œæ™‚åˆ»é¸æŠ]                       â”‚ â”‚ â”‚
â”‚                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                        â”‚
â”‚                                  â–¼ â‘¢User Interaction                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚API Gateway  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        Slack Interactive           â”‚   â”‚
â”‚  â”‚             â”‚                â”‚                                     â”‚   â”‚
â”‚  â”‚/interactive â”‚                â”‚ â”Œâ”€ Parse Slack Payload              â”‚   â”‚
â”‚  â”‚            â”‚                â”‚ â”œâ”€ Validate Signature               â”‚   â”‚
â”‚  â”‚            â”‚                â”‚ â””â”€ Route to Callback Handler        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                         â”‚                        â”‚
â”‚        â–¼ â‘£Route to Handler                       â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Callback Handler            â”‚  â”‚    Update DynamoDB          â”‚ â”‚
â”‚  â”‚                                     â”‚  â”‚                             â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Process Approval/Rejection      â”‚  â”‚ â”Œâ”€ Status: approved         â”‚ â”‚
â”‚  â”‚ â”œâ”€ Parse Schedule Selection        â”‚  â”‚ â”œâ”€ Approved By: user@...     â”‚ â”‚
â”‚  â”‚ â”œâ”€ Create EventBridge Schedule     â”‚  â”‚ â”œâ”€ Schedule Time: 23:00      â”‚ â”‚
â”‚  â”‚ â””â”€ Update DynamoDB Status          â”‚  â”‚ â””â”€ TTL: +90 days             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                                                    â”‚
â”‚                     â–¼ â‘¤Create One-time Schedule                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 EventBridge Scheduler                               â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Schedule: at(2024-01-01T23:00:00)                              â”‚ â”‚
â”‚  â”‚ â”œâ”€ Target: zengin-diff-executor                                   â”‚ â”‚
â”‚  â”‚ â”œâ”€ Payload: {"diffId": "diff-20240101-001"}                      â”‚ â”‚
â”‚  â”‚ â””â”€ Execution: One-time only                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼ â‘¥Scheduled Execution                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Diff Executor                                   â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Retrieve Diff from DynamoDB                                    â”‚ â”‚
â”‚  â”‚ â”œâ”€ Large Data from S3 (if needed)                               â”‚ â”‚
â”‚  â”‚ â”œâ”€ Connect to PostgreSQL (advasa-django)                        â”‚ â”‚
â”‚  â”‚ â”œâ”€ Execute SQL Transactions                                      â”‚ â”‚
â”‚  â”‚ â”œâ”€ Update Execution Status                                       â”‚ â”‚
â”‚  â”‚ â””â”€ Send Completion Notification                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼ â‘¦Completion Notification            â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                â”‚                     Slack                              â”‚ â”‚
â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                â”‚ â”‚  âœ… æ›´æ–°å®Œäº†é€šçŸ¥                                     â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â”Œâ”€ å‡¦ç†æ™‚åˆ»: 2024-01-01 23:00:15                  â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â”œâ”€ å‡¦ç†ä»¶æ•°: 6ä»¶ (è¿½åŠ 3, æ›´æ–°2, å‰Šé™¤1)             â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â”œâ”€ å®Ÿè¡Œæ™‚é–“: 2.3ç§’                                â”‚ â”‚ â”‚
â”‚                â”‚ â”‚  â””â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æˆåŠŸ                                â”‚ â”‚ â”‚
â”‚                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & å¾©æ—§æˆ¦ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Error Handling Strategy                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Retry Strategy  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Lambda Function â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        Dead Letter Queue       â”‚ â”‚
â”‚  â”‚                 â”‚                  â”‚                                 â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Max Retries: 3              â”‚  â”‚ â”Œâ”€ Failed Events Storage       â”‚ â”‚
â”‚  â”‚ â”œâ”€ Backoff: Exponential       â”‚  â”‚ â”œâ”€ TTL: 14 days                â”‚ â”‚
â”‚  â”‚ â”œâ”€ Initial: 1s, 2s, 4s        â”‚  â”‚ â”œâ”€ Manual Replay Capability    â”‚ â”‚
â”‚  â”‚ â””â”€ Circuit Breaker            â”‚  â”‚ â””â”€ Alarm Integration            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      CloudWatch Alarms                             â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Lambda Errors > 5%                                             â”‚ â”‚
â”‚  â”‚ â”œâ”€ Lambda Duration > 30s                                          â”‚ â”‚
â”‚  â”‚ â”œâ”€ DynamoDB Throttling                                            â”‚ â”‚
â”‚  â”‚ â”œâ”€ External API Failures                                          â”‚ â”‚
â”‚  â”‚ â””â”€ Automatic SNS â†’ Slack Notifications                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### VPCåˆ†é›¢è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Security Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Internet Gateway                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       Public Subnets                               â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚ â”‚
â”‚  â”‚ â”‚    NAT      â”‚  â”‚    ALB      â”‚  â† Only for future services      â”‚ â”‚
â”‚  â”‚ â”‚  Gateway A  â”‚  â”‚  (Future)   â”‚                                   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                                                    â”‚
â”‚                    â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Private Subnets                               â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚                   Lambda Functions                             â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€ All Functions in Private Subnets                           â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”œâ”€ No Direct Internet Access                                  â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”œâ”€ VPC Endpoints for AWS Service Access                      â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€ Database Access via Security Groups                       â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚                    Database Layer                               â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€ RDS PostgreSQL (Private)                                    â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”œâ”€ Security Group: Lambda â†’ DB                                 â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â”œâ”€ Encryption at Rest                                          â”‚ â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€ Encryption in Transit                                       â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       VPC Endpoints                                â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Secrets Manager    â”œâ”€ CloudWatch Logs  â”œâ”€ EventBridge          â”‚ â”‚
â”‚  â”‚ â”œâ”€ CloudWatch        â”œâ”€ EventBridge Scheduler â”œâ”€ Lambda Service   â”‚ â”‚
â”‚  â”‚ â”œâ”€ S3 Gateway        â”œâ”€ DynamoDB Gateway                          â”‚ â”‚
â”‚  â”‚ â””â”€ All AWS API calls routed through PrivateLink                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èªè¨¼ãƒ»èªå¯

#### Slackç½²åæ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹

```python
def validate_slack_signature(headers: dict, body: str, secret: str) -> bool:
    """
    Slackç½²åæ¤œè¨¼ã®å®Ÿè£…
    """
    timestamp = headers.get('X-Slack-Request-Timestamp')
    signature = headers.get('X-Slack-Signature')
    
    # Replay attacké˜²æ­¢ (5åˆ†ä»¥å†…ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿è¨±å¯)
    if abs(time.time() - int(timestamp)) > 300:
        return False
    
    # ç½²åç”Ÿæˆ
    basestring = f"v0:{timestamp}:{body}"
    expected_signature = 'v0=' + hmac.new(
        secret.encode(),
        basestring.encode(),
        hashlib.sha256
    ).hexdigest()
    
    # å®šæ•°æ™‚é–“æ¯”è¼ƒã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã‚’é˜²æ­¢
    return hmac.compare_digest(signature, expected_signature)
```

#### IAMæ¨©é™è¨­è¨ˆ (æœ€å°æ¨©é™ã®åŸå‰‡)

```typescript
// Diff Processor Lambda æ¨©é™
const diffProcessorPolicy = new iam.PolicyStatement({
  actions: [
    'dynamodb:PutItem',           // å·®åˆ†ãƒ‡ãƒ¼ã‚¿ä½œæˆ
    'dynamodb:GetItem',           // å·®åˆ†ãƒ‡ãƒ¼ã‚¿å–å¾—
    's3:PutObject',               // å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    'secretsmanager:GetSecretValue', // DBèªè¨¼æƒ…å ±å–å¾—
  ],
  resources: [
    this.diffTable.tableArn,
    `${diffDataBucket.bucketArn}/*`,
    config.database.secretArn,
    zenginConfig.slack.botTokenSecret,
  ],
});

// Callback Handler Lambda æ¨©é™
const callbackHandlerPolicy = new iam.PolicyStatement({
  actions: [
    'dynamodb:UpdateItem',        // çŠ¶æ…‹æ›´æ–°
    'scheduler:CreateSchedule',   // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ
    'iam:PassRole',              // Schedulerãƒ­ãƒ¼ãƒ«æ¨©é™å§”è­²
  ],
  resources: [
    this.diffTable.tableArn,
    `arn:aws:scheduler:*:*:schedule/*`,
    this.eventBridge.schedulerRole.roleArn,
  ],
});
```

### ãƒ‡ãƒ¼ã‚¿ä¿è­·

#### æš—å·åŒ–è¨­è¨ˆ

**ä¿å­˜æ™‚æš—å·åŒ–**:
- **DynamoDB**: AWS KMS ã‚«ã‚¹ã‚¿ãƒãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚­ãƒ¼
- **S3**: AES-256æš—å·åŒ– (S3 Managed)
- **RDS**: é€æ˜ãƒ‡ãƒ¼ã‚¿æš—å·åŒ– (TDE)
- **Secrets Manager**: AWS KMSã«ã‚ˆã‚‹æš—å·åŒ–

**è»¢é€æ™‚æš—å·åŒ–**:
- **API Gateway**: TLS 1.2ä»¥ä¸Š
- **Lambda â†” RDS**: SSL/TLSæ¥ç¶šå¼·åˆ¶
- **Lambda â†” AWS Services**: HTTPS/TLS

## ğŸ“Š ç›£è¦–ãƒ»å¯è¦³æ¸¬æ€§

### åŒ…æ‹¬çš„ç›£è¦–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Observability Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       Metrics Layer                                â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚ â”‚   Lambda    â”‚  â”‚  DynamoDB   â”‚  â”‚API Gateway  â”‚                â”‚ â”‚
â”‚  â”‚ â”‚   Metrics   â”‚  â”‚   Metrics   â”‚  â”‚   Metrics   â”‚                â”‚ â”‚
â”‚  â”‚ â”‚             â”‚  â”‚             â”‚  â”‚             â”‚                â”‚ â”‚
â”‚  â”‚ â”‚ ãƒ»Duration  â”‚  â”‚ ãƒ»Throttles â”‚  â”‚ ãƒ»Latency   â”‚                â”‚ â”‚
â”‚  â”‚ â”‚ ãƒ»Errors    â”‚  â”‚ ãƒ»Consumed  â”‚  â”‚ ãƒ»4XX/5XX   â”‚                â”‚ â”‚
â”‚  â”‚ â”‚ ãƒ»Invokes   â”‚  â”‚ ãƒ»Capacity  â”‚  â”‚ ãƒ»Count     â”‚                â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Logs Layer                                  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ Structured JSON Logs                                           â”‚ â”‚
â”‚  â”‚ â”œâ”€ CloudWatch Log Groups per Lambda                               â”‚ â”‚
â”‚  â”‚ â”œâ”€ Log Retention: 14 days (dev), 30 days (prod)                  â”‚ â”‚
â”‚  â”‚ â”œâ”€ Log Insights Queries for Troubleshooting                      â”‚ â”‚
â”‚  â”‚ â””â”€ Sensitive Data Masking                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Tracing Layer                                 â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ X-Ray Distributed Tracing                                      â”‚ â”‚
â”‚  â”‚ â”œâ”€ Service Map Visualization                                      â”‚ â”‚
â”‚  â”‚ â”œâ”€ Performance Bottleneck Detection                               â”‚ â”‚
â”‚  â”‚ â”œâ”€ External API Call Monitoring                                   â”‚ â”‚
â”‚  â”‚ â””â”€ Database Query Performance                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Alerting Layer                                â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚ â”Œâ”€ CloudWatch Alarms                                              â”‚ â”‚
â”‚  â”‚ â”œâ”€ SNS â†’ Slack Integration                                        â”‚ â”‚
â”‚  â”‚ â”œâ”€ PagerDuty Integration (prod)                                   â”‚ â”‚
â”‚  â”‚ â”œâ”€ Escalation Policies                                            â”‚ â”‚
â”‚  â”‚ â””â”€ Runbook Links in Alerts                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šè©³ç´°

#### é‡è¦åº¦åˆ¥ã‚¢ãƒ©ãƒ¼ãƒˆ

**P1 (Critical)**:
- Lambda error rate > 10%
- DynamoDB throttling events
- Database connection failures
- API Gateway 5XX rate > 5%

**P2 (High)**:
- Lambda error rate > 5%
- Lambda duration > 30 seconds
- DynamoDB consumed capacity > 80%
- External API timeouts

**P3 (Medium)**:
- Lambda cold start rate > 20%
- S3 PUT errors
- CloudWatch log ingestion delays

## ğŸš€ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### Auto Scalingè¨­è¨ˆ

#### LambdaåŒæ™‚å®Ÿè¡Œåˆ¶å¾¡

```typescript
const lambdaConfigs = {
  'zengin-diff-processor': {
    reservedConcurrency: 10,       // åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
    timeout: 900,                  // 15åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    memorySize: 1024,             // 1GB ãƒ¡ãƒ¢ãƒª
  },
  'slack-interactive': {
    reservedConcurrency: 5,        // Slack APIåˆ¶é™è€ƒæ…®
    timeout: 30,                   // 30ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    memorySize: 512,              // 512MB ãƒ¡ãƒ¢ãƒª
  },
};
```

#### DynamoDB Auto Scaling

```typescript
// ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®è¨­å®š
const autoScalingSettings = {
  readCapacity: {
    minCapacity: 5,
    maxCapacity: 100,
    targetUtilization: 70,
  },
  writeCapacity: {
    minCapacity: 5,
    maxCapacity: 200,
    targetUtilization: 70,
  },
};
```

### æ€§èƒ½æœ€é©åŒ–

#### Cold Startå¯¾ç­–

1. **Provisioned Concurrency** (æœ¬ç•ªç’°å¢ƒ)
2. **Lambda Layeræœ€é©åŒ–** (å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
3. **VPC ENI ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—**
4. **ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºæœ€é©åŒ–**

#### å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†

```python
def handle_large_diff_data(diff_data: dict) -> str:
    """
    å¤§å®¹é‡å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„å‡¦ç†
    """
    # ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ (400KBä»¥ä¸Šã¯S3ã«ä¿å­˜)
    if len(json.dumps(diff_data).encode()) > 400 * 1024:
        # S3ã«ä¿å­˜
        s3_key = f"diffs/{diff_data['id']}.json"
        s3_client.put_object(
            Bucket=S3_BUCKET_NAME,
            Key=s3_key,
            Body=json.dumps(diff_data),
            ContentType='application/json'
        )
        
        # DynamoDBã«ã¯å‚ç…§ã®ã¿ä¿å­˜
        return {
            'id': diff_data['id'],
            'data_location': f's3://{S3_BUCKET_NAME}/{s3_key}',
            'size': len(json.dumps(diff_data)),
            'summary': diff_data.get('summary', {})
        }
    else:
        # DynamoDBã«ç›´æ¥ä¿å­˜
        return diff_data
```

## ğŸ“ è¨­è¨ˆåŸå‰‡

### 1. å˜ä¸€è²¬ä»»ã®åŸå‰‡ (Single Responsibility)

å„Lambdaé–¢æ•°ã¯æ˜ç¢ºã«å®šç¾©ã•ã‚ŒãŸå˜ä¸€ã®è²¬ä»»ã‚’æŒã¡ã¾ã™ï¼š

- **Events Handler**: Slack Events APIã®å‡¦ç†ã®ã¿
- **Interactive Handler**: Slackã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‡¦ç†ã®ã¿
- **Diff Processor**: å·®åˆ†æ¤œå‡ºå‡¦ç†ã®ã¿
- **Callback Handler**: æ‰¿èªãƒ•ãƒ­ãƒ¼å‡¦ç†ã®ã¿
- **Diff Executor**: å·®åˆ†å®Ÿè¡Œå‡¦ç†ã®ã¿

### 2. ç–çµåˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Loose Coupling)

ã‚µãƒ¼ãƒ“ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ã‚’æœ€å°åŒ–ï¼š

- **éåŒæœŸé€šä¿¡**: EventBridgeçµŒç”±ã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•
- **ãƒ‡ãƒ¼ã‚¿åˆ†é›¢**: å„ã‚µãƒ¼ãƒ“ã‚¹ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **APIå¥‘ç´„**: æ˜ç¢ºã«å®šç¾©ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 3. é«˜å¯ç”¨æ€§ (High Availability)

- **Multi-AZé…ç½®**: è¤‡æ•°ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³
- **è‡ªå‹•ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼**: AWSã‚µãƒ¼ãƒ“ã‚¹ã®å†—é•·æ€§æ´»ç”¨
- **Graceful degradation**: éƒ¨åˆ†çš„éšœå®³æ™‚ã®å„ªé›…ãªç¸®é€€

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒã‚¤ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³

- **Defense in Depth**: å¤šå±¤é˜²å¾¡æˆ¦ç•¥
- **Principle of Least Privilege**: æœ€å°æ¨©é™ã®åŸå‰‡
- **Encryption Everywhere**: å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã®æš—å·åŒ–

### 5. é‹ç”¨æ€§ (Operability)

- **Infrastructure as Code**: CDKã«ã‚ˆã‚‹å®£è¨€çš„ã‚¤ãƒ³ãƒ•ãƒ©
- **Automated Deployment**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- **Comprehensive Monitoring**: åŒ…æ‹¬çš„ãªç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€AdvasaBusinessBaseã¯**æ‹¡å¼µæ€§**ã€**å¯ç”¨æ€§**ã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ã€**é‹ç”¨æ€§**ã‚’ä¸¡ç«‹ã—ãŸå …ç‰¢ãªãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚